<template>
  <q-btn flat round dense icon="notifications" @click="show = true"><q-badge v-if="unreadCount > 0" color="red" floating>{{ unreadCount }}</q-badge></q-btn>
  <q-dialog v-model="show" position="right" maximized><q-card style="width: 400px; max-width: 90vw;"><q-card-section class="row items-center q-pb-none"><div class="text-h6">Notifications</div><q-space /><q-btn icon="close" flat round dense v-close-popup /></q-card-section><q-separator /><q-card-section class="q-pt-none" style="max-height: calc(100vh - 150px); overflow-y: auto;"><q-list v-if="notifications.length > 0"><q-item v-for="notification in notifications" :key="notification.id" clickable @click="markAsRead(notification.id)" :class="{'bg-blue-1': !notification.read}"><q-item-section avatar><q-icon :name="notification.icon || 'notifications'" :color="notification.read ? 'grey' : 'primary'" /></q-item-section><q-item-section><q-item-label>{{ notification.title }}</q-item-label><q-item-label caption>{{ notification.message }}</q-item-label><q-item-label caption class="text-grey">{{ formatDate(notification.createdAt) }}</q-item-label></q-item-section></q-item></q-list><div v-else class="text-center text-grey-7 q-pa-lg">No notifications</div></q-card-section><q-separator /><q-card-actions align="center"><q-btn flat label="Mark all as read" color="primary" @click="markAllAsRead" v-if="unreadCount > 0" /></q-card-actions></q-card></q-dialog>
</template>
<script>
import { defineComponent, ref } from 'vue'; import { useNotifications } from '../composables/useNotifications';
export default defineComponent({ name: 'NotificationBell', setup() { const { notifications, unreadCount, markAsRead, markAllAsRead } = useNotifications(); const show = ref(false); const formatDate = (date) => new Date(date).toLocaleString(); return { show, notifications, unreadCount, markAsRead, markAllAsRead, formatDate }; } });
</script>
